import{r as p,g as D,R as E,u as _,a as V,s as O,j as t,c as $,b as A}from"./styles-mUuRymAq.js";import{f as F}from"./time-Bu1cAEOJ.js";import{e as L}from"./text-C_W9g4td.js";const M={},y=e=>{let n;const s=new Set,r=(o,u)=>{const m=typeof o=="function"?o(n):o;if(!Object.is(m,n)){const i=n;n=u??(typeof m!="object"||m===null)?m:Object.assign({},n,m),s.forEach(x=>x(n,i))}},a=()=>n,f={setState:r,getState:a,getInitialState:()=>h,subscribe:o=>(s.add(o),()=>s.delete(o)),destroy:()=>{(M?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},h=n=e(r,a,f);return f},P=e=>e?y(e):y;var T={exports:{}},k={},C={exports:{}},R={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g=p;function z(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var U=typeof Object.is=="function"?Object.is:z,B=g.useState,H=g.useEffect,W=g.useLayoutEffect,Q=g.useDebugValue;function K(e,n){var s=n(),r=B({inst:{value:s,getSnapshot:n}}),a=r[0].inst,c=r[1];return W(function(){a.value=s,a.getSnapshot=n,j(a)&&c({inst:a})},[e,s,n]),H(function(){return j(a)&&c({inst:a}),e(function(){j(a)&&c({inst:a})})},[e]),Q(s),s}function j(e){var n=e.getSnapshot;e=e.value;try{var s=n();return!U(e,s)}catch{return!0}}function G(e,n){return n()}var Y=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?G:K;R.useSyncExternalStore=g.useSyncExternalStore!==void 0?g.useSyncExternalStore:Y;C.exports=R;var q=C.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v=p,J=q;function X(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Z=typeof Object.is=="function"?Object.is:X,ee=J.useSyncExternalStore,te=v.useRef,se=v.useEffect,ne=v.useMemo,re=v.useDebugValue;k.useSyncExternalStoreWithSelector=function(e,n,s,r,a){var c=te(null);if(c.current===null){var d={hasValue:!1,value:null};c.current=d}else d=c.current;c=ne(function(){function f(i){if(!h){if(h=!0,o=i,i=r(i),a!==void 0&&d.hasValue){var x=d.value;if(a(x,i))return u=x}return u=i}if(x=u,Z(o,i))return x;var b=r(i);return a!==void 0&&a(x,b)?(o=i,x):(o=i,u=b)}var h=!1,o,u,m=s===void 0?null:s;return[function(){return f(n())},m===null?void 0:function(){return f(m())}]},[n,s,r,a]);var l=ee(e,c[0],c[1]);return se(function(){d.hasValue=!0,d.value=l},[l]),re(l),l};T.exports=k;var ae=T.exports;const ie=D(ae),I={},{useDebugValue:oe}=E,{useSyncExternalStoreWithSelector:ce}=ie;let S=!1;const le=e=>e;function de(e,n=le,s){(I?"production":void 0)!=="production"&&s&&!S&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),S=!0);const r=ce(e.subscribe,e.getState,e.getServerState||e.getInitialState,n,s);return oe(r),r}const N=e=>{(I?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const n=typeof e=="function"?P(e):e,s=(r,a)=>de(n,r,a);return Object.assign(s,n),s},ue=e=>e?N(e):N,me=ue((e,n)=>({query:"",results:[],isSearching:!1,error:null,settings:null,setQuery:s=>{e({query:s})},search:async s=>{if(!s.trim()){e({results:[],error:null});return}e({isSearching:!0,error:null,query:s});try{const r=await O(s);e({results:r,isSearching:!1})}catch(r){const a=r instanceof Error?r.message:"Search failed";e({error:a,results:[],isSearching:!1})}},loadSettings:async()=>{try{const s=await V();e({settings:s})}catch(s){console.error("Failed to load settings",s)}},saveSettings:async s=>{try{const a={...n().settings,...s};await _(s),e({settings:a})}catch(r){throw console.error("Failed to save settings",r),r}},clearResults:()=>{e({results:[],query:"",error:null})}}));function xe(e){const[n,s]=p.useState(!1),[r,a]=p.useState(!1),[c,d]=p.useState("");p.useEffect(()=>{const h=!!(window.SpeechRecognition||window.webkitSpeechRecognition);a(h)},[]);const l=p.useCallback(()=>{if(!r)return;const h=window.SpeechRecognition||window.webkitSpeechRecognition;if(!h)return;const o=new h;o.continuous=!1,o.interimResults=!0,o.lang="en-US",o.onresult=u=>{let m="",i="";for(let x=u.resultIndex;x<u.results.length;x++){const b=u.results[x][0].transcript;u.results[x].isFinal?i+=b:m+=b}m&&d(m),i&&(d(""),e(i))},o.onerror=u=>{console.error("Speech recognition error:",u.error),s(!1),d("")},o.onend=()=>{s(!1),d("")},o.start(),s(!0)},[r,e]),f=p.useCallback(()=>{s(!1),d("")},[]);return{isListening:n,isSupported:r,interimText:c,startListening:l,stopListening:f}}function he({value:e,onChange:n,onSubmit:s,isLoading:r}){const[a,c]=p.useState(!1),d=i=>{n(i),setTimeout(()=>{s()},100)},{isListening:l,isSupported:f,interimText:h,startListening:o}=xe(d),u=i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),s())},m=l&&h?h:e;return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:m,onChange:i=>n(i.target.value),onKeyDown:u,placeholder:"Ask about pages you've visited...",className:"input flex-1",disabled:l||r}),f&&t.jsx("button",{onClick:o,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),disabled:l||r,className:`btn ${l?"bg-red-600 hover:bg-red-700":"btn-secondary"} px-4`,"aria-label":"Voice input",children:l?"🔴":"🎤"}),t.jsx("button",{onClick:s,disabled:!e.trim()||r||l,className:"btn btn-primary px-6",children:r?"Searching...":"Search"})]}),l&&t.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 text-center text-sm text-muted",children:"Listening..."}),a&&!l&&t.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 text-center text-xs text-muted",children:"Click to start voice input"})]})}function fe({result:e}){const n=L(e.url),s=()=>{chrome.tabs.create({url:e.url})},r=async()=>{try{await navigator.clipboard.writeText(e.url)}catch(a){console.error("Failed to copy URL",a)}};return t.jsxs("div",{className:"card hover:bg-slate-700 transition-colors duration-200",children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-foreground flex-1",children:e.title}),t.jsxs("span",{className:"text-xs text-muted ml-2",children:["#",e.rank]})]}),t.jsxs("div",{className:"text-sm text-muted mb-2",children:[t.jsx("span",{children:n}),t.jsx("span",{className:"mx-2",children:"•"}),t.jsx("span",{children:F(e.lastVisit)}),e.visitCount>1&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mx-2",children:"•"}),t.jsxs("span",{children:[e.visitCount," visits"]})]})]}),e.memoryCard&&t.jsx("div",{className:"mb-3",children:t.jsx("p",{className:"text-sm text-foreground/90",children:e.memoryCard})}),e.tags&&e.tags.length>0&&t.jsx("div",{className:"flex flex-wrap mb-3",children:e.tags.map((a,c)=>t.jsx("span",{className:"tag",children:a},c))}),t.jsx("div",{className:"text-xs text-muted mb-3 italic",children:e.matchReason}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:s,className:"btn btn-primary text-sm flex-1",children:"Open"}),t.jsx("button",{onClick:r,className:"btn btn-secondary text-sm",children:"Copy URL"})]})]})}function pe({hasSearched:e}){return e?t.jsxs("div",{className:"text-center py-12 px-4",children:[t.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),t.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No results found"}),t.jsx("p",{className:"text-muted text-sm mb-4",children:"Try a different search query or check if indexing is enabled in settings."})]}):t.jsxs("div",{className:"text-center py-12 px-4",children:[t.jsx("div",{className:"text-6xl mb-4",children:"🧠"}),t.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Talk To Your History"}),t.jsx("p",{className:"text-muted text-sm mb-6",children:"Search your browsing history using natural language."}),t.jsxs("div",{className:"text-left max-w-md mx-auto space-y-2",children:[t.jsx("p",{className:"text-sm text-muted",children:t.jsx("strong",{children:"Try asking:"})}),t.jsxs("ul",{className:"text-sm text-muted space-y-1 list-disc list-inside",children:[t.jsx("li",{children:'"Two weeks ago I viewed a SaaS for content planning"'}),t.jsx("li",{children:'"That article about AI pricing models"'}),t.jsx("li",{children:'"The FAQ page I saw yesterday"'})]})]})]})}function be(){return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"mb-6 p-4 bg-blue-900/20 border border-blue-700/50 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"animate-spin",children:"🔄"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-blue-300",children:"Using AI to understand your query..."}),t.jsx("div",{className:"text-sm text-blue-400/70 mt-1",children:"Expanding search terms → Searching history → Ranking results"})]})]})}),[1,2,3].map(e=>t.jsxs("div",{className:"card animate-skeleton",children:[t.jsx("div",{className:"h-6 bg-slate-700 rounded w-3/4 mb-3"}),t.jsx("div",{className:"h-4 bg-slate-700 rounded w-1/2 mb-3"}),t.jsx("div",{className:"h-4 bg-slate-700 rounded w-full mb-2"}),t.jsx("div",{className:"h-4 bg-slate-700 rounded w-5/6 mb-3"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"h-8 bg-slate-700 rounded flex-1"}),t.jsx("div",{className:"h-8 bg-slate-700 rounded w-24"})]})]},e))]})}function ge(){const{query:e,results:n,isSearching:s,error:r,setQuery:a,search:c,loadSettings:d,settings:l}=me(),[f,h]=p.useState(!1),[o,u]=p.useState(!1);p.useEffect(()=>{d()},[d]);const m=async()=>{e.trim()&&(h(!0),await c(e))},i=async()=>{try{await A(),alert('Test data seeded! Try searching for "content planning" or "AI pricing"')}catch(b){console.error("Failed to seed test data",b),alert("Failed to seed test data")}},x=()=>{chrome.runtime.openOptionsPage()};return t.jsxs("div",{className:"w-[600px] h-[500px] flex flex-col bg-background text-foreground",children:[t.jsxs("div",{className:"p-4 border-b border-gray-800",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h1",{className:"text-xl font-bold",children:"Talk To Your History"}),t.jsx("button",{onClick:()=>u(!o),className:"text-muted hover:text-foreground text-sm","aria-label":"Settings",children:"⚙️"})]}),t.jsx(he,{value:e,onChange:a,onSubmit:m,isLoading:s}),o&&t.jsxs("div",{className:"flex gap-2 mt-2",children:[t.jsx("button",{onClick:i,className:"btn btn-secondary text-xs",children:"Seed Test Data"}),t.jsx("button",{onClick:x,className:"btn btn-secondary text-xs",children:"Open Settings"})]})]}),l&&!l.indexingEnabled&&!f&&t.jsxs("div",{className:"mx-4 mt-4 p-3 bg-amber-900/30 border border-amber-700 rounded text-sm",children:["⚠️ Indexing is disabled. Enable it in"," ",t.jsx("button",{onClick:x,className:"underline",children:"settings"})," ","to search your history."]}),r&&t.jsxs("div",{className:"mx-4 mt-4 p-3 bg-red-900/30 border border-red-700 rounded text-sm",children:["❌ ",r]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:s?t.jsx(be,{}):n.length>0?t.jsx("div",{className:"space-y-3",children:n.map(b=>t.jsx(fe,{result:b},b.id))}):t.jsx(pe,{hasSearched:f})}),t.jsx("div",{className:"p-2 border-t border-gray-800 text-center text-xs text-muted",children:"Powered by Chrome Built-in AI • All processing on-device"})]})}const w=document.getElementById("root");w&&$(w).render(t.jsx(E.StrictMode,{children:t.jsx(ge,{})}));
